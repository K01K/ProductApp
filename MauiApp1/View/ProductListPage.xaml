<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="ProductApp.Views.ProductListPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ProductApp.ViewModels"
             x:DataType="vm:ProductListViewModel"
             Title="{Binding Title}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Nagłówek z przyciskiem odświeżania -->
        <Button Grid.Row="0"
                Text="Odśwież listę"
                Command="{Binding LoadProductsCommand}"
                Margin="20,10"
                IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"
                BackgroundColor="#512BD4"
                TextColor="White" />

        <!-- Wskaźnik ładowania -->
        <ActivityIndicator Grid.Row="1"
                          IsVisible="{Binding IsBusy}"
                          IsRunning="{Binding IsBusy}"
                          Color="#512BD4"
                          Scale="1.5"
                          HorizontalOptions="Center"
                          VerticalOptions="Center" />

        <!-- Lista produktów -->
        <CollectionView Grid.Row="1"
                        ItemsSource="{Binding Products}"
                        SelectionMode="Single"
                        SelectionChangedCommand="{Binding ProductSelectedCommand}"
                        SelectionChangedCommandParameter="{Binding SelectedItem, Source={RelativeSource Self}}"
                        BackgroundColor="Transparent"
                        IsVisible="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}">

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border Margin="15,5"
                            Padding="15"
                            BackgroundColor="White"
                            Stroke="LightGray"
                            StrokeThickness="1"
                            StrokeShape="RoundRectangle 12">

                        <Grid ColumnDefinitions="80,*,Auto" ColumnSpacing="15">

                            <!-- Obrazek produktu -->
                            <Border Grid.Column="0"
                                    BackgroundColor="#F5F5F5"
                                    StrokeThickness="1"
                                    Stroke="LightGray"
                                    StrokeShape="RoundRectangle 8"
                                    WidthRequest="70"
                                    HeightRequest="70">
                                <Image Source="{Binding ImageUrl}"
                                       Aspect="AspectFit" />
                            </Border>

                            <!-- Informacje o produkcie -->
                            <StackLayout Grid.Column="1" Spacing="4">
                                <Label Text="{Binding Name}"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       LineBreakMode="TailTruncation"
                                       MaxLines="2" />

                                <Label Text="{Binding Category}"
                                       FontSize="12"
                                       TextColor="Gray" />

                                <Label Text="{Binding Stock, StringFormat='Dostępne: {0} szt.'}"
                                       FontSize="12"
                                       TextColor="DarkGreen" />
                            </StackLayout>

                            <!-- Cena -->
                            <Label Grid.Column="2"
                                   Text="{Binding Price, StringFormat='{0:C2}'}"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="#512BD4"
                                   VerticalOptions="Center" />
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Komunikat gdy brak produktów -->
        <Label Grid.Row="1"
               Text="Brak produktów do wyświetlenia"
               FontSize="16"
               TextColor="Gray"
               HorizontalOptions="Center"
               VerticalOptions="Center"
               IsVisible="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}" />
    </Grid>
</ContentPage>